<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Calcul des gains</title>
</head>
<body>
  <textarea id="cartes" rows="15" cols="50">
32T3K 765
T55J5 684
KK677 28
KTJJT 220
QQQJA 483
  </textarea>

  <button onclick="calculerGains()">Calculer les gains</button>

  <textarea id="rangs" rows="15" cols="50"></textarea>
  <textarea id="gains" rows="1" cols="50"></textarea>

  <script>
    function calculerGains() {
      const cartesTextarea = document.getElementById('cartes');
      const cartes = cartesTextarea.value.trim().split('\n');

      const rangsTries = calculerRangsTries(cartes);
      document.getElementById('rangs').value = rangsTries.reverse().join('\n');

      const gains = calculerGainsParCarte(cartes, rangsTries);
      document.getElementById('gains').value = `Total des gains : ${gains}`;
    }

    function determinerTypeDeMain(carte) {
      const counts = {};
      for (let i = 0; i < carte.length; i++) {
        const card = carte[i];
        counts[card] = (counts[card] || 0) + 1;
      }

      const values = Object.values(counts);
      const uniqueValues = [...new Set(values)];
      const sortedUnique = uniqueValues.sort((a, b) => b - a);

      if (sortedUnique.length === 1) return 'Five of a kind';
      if (sortedUnique.length === 2) {
        if (sortedUnique[0] === 4 || sortedUnique[1] === 4) return 'Four of a kind';
        return 'Full house';
      }
      if (sortedUnique.length === 3) {
        if (sortedUnique[0] === 3 || sortedUnique[1] === 3 || sortedUnique[2] === 3) return 'Three of a kind';
        return 'Two pair';
      }
      if (sortedUnique.length === 4) return 'One pair';
      return 'High card';
    }

    function calculerRangsTries(cartes) {
      const ranks = cartes.map((carte, index) => {
        return { index: index + 1, carte };
      });

      ranks.sort((a, b) => {
        const typeA = determinerTypeDeMain(a.carte);
        const typeB = determinerTypeDeMain(b.carte);

        if (typeA !== typeB) {
          const typesPossibles = [
            'Five of a kind', 'Four of a kind', 'Full house', 'Three of a kind', 'Two pair', 'One pair', 'High card'
          ];
          return typesPossibles.indexOf(typeB) - typesPossibles.indexOf(typeA);
        }

        const valuesMap = { A: 14, K: 13, Q: 12, J: 11, T: 10 };

        const valuesA = a.carte.slice(0, -4).split('').map(card => valuesMap[card] || parseInt(card));
        const valuesB = b.carte.slice(0, -4).split('').map(card => valuesMap[card] || parseInt(card));

        for (let i = 0; i < valuesA.length; i++) {
          if (valuesA[i] !== valuesB[i]) {
            return valuesB[i] - valuesA[i];
          }
        }

        return 0;
      });

      const orderedRanks = ranks.map(rank => rank.index);
      return [orderedRanks.indexOf(1) + 1, orderedRanks.indexOf(4) + 1, orderedRanks.indexOf(5) + 1, orderedRanks.indexOf(2) + 1, orderedRanks.indexOf(3) + 1];
    }

    function calculerGainsParCarte(cartes, rangs) {
      const gains = rangs.map((index, i) => {
        const [_, nombre] = cartes[i].split(' ');
        return parseInt(nombre) * index;
      }).reduce((total, gain) => total + gain, 0);
      return gains;
    }
  </script>
</body>
</html>
